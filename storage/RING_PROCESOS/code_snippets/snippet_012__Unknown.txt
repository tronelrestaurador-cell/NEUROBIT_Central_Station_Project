python






















1



2



3



4





5



6



7





8





9



10



11



12





13



14



15



16



17





18



19



20



21



22



23



24



25





26





27





28



29



30





31





32



33



34



35



36



37



38



39





40



41



42



43





44



45





46



47



48



49



50



51





52



53



54



55



56





57



58



59



60



61





62



63



64



65



66



67





















































































































































































































































































































































































































































import yaml

import json

from collections import defaultdict



class ContextExpander:

    """Expande contexto mediante polisemia fractal según metadatos"""

    

    def __init__(self, config_path="config/system_vars.yaml"):

        with open(config_path, 'r') as f:

            self.config = yaml.safe_load(f)

        self.coherence_threshold = self.config['LOGOS_COHERENCE_THRESHOLD']['value']

    

    def expand_context(self, base_message, metadata_tags):

        """

        Expande el contexto del mensaje usando metadatos y principio de polisemia

        Retorna versión ampliada solo si supera umbral de coherencia

        """

        expanded_context = {

            "original": base_message,

            "tags": metadata_tags,

            "semantic_expansions": [],

            "coherence_score": 0.0

        }

        

        # Aplicar expansión fractal según tags

        for tag in metadata_tags:

            if tag.startswith("logos:"):

                expanded_context["semantic_expansions"].append(

                    self._apply_logos_expansion(base_message, tag)

                )

            elif tag.startswith("node:"):

                expanded_context["semantic_expansions"].append(

                    self._apply_node_expansion(base_message, tag)

                )

        

        # Calcular coherencia

        expanded_context["coherence_score"] = self._calculate_coherence(expanded_context)

        

        # Retornar solo si supera umbral

        if expanded_context["coherence_score"] >= self.coherence_threshold:

            return expanded_context

        return {"error": "Coherencia insuficiente para expansión"}

    

    def _apply_logos_expansion(self, message, tag):

        """Aplica expansión según principios del Logos restaurado"""

        principles = {

            "logos:unity": "Integración de opuestos según Heráclito",

            "logos:verb": "El verbo como acto creador según Eliphas Lévi",

            "logos:quantum": "No-localidad como principio unificador"

        }

        principle = principles.get(tag, "Principio no definido")

        return {

            "principle": principle,

            "expanded_message": f"{message} [Expansión Logos: {principle}]"

        }

    

    def _calculate_coherence(self, context):

        """Algoritmo simple de coherencia basado en densidad semántica"""

        base_length = len(context["original"])

        expansions_length = sum(len(exp.get("expanded_message", "")) for exp in context["semantic_expansions"])

        

        if base_length == 0:

            return 0.0

            

        # Coherencia aumenta con densidad significativa pero no redundancia

        semantic_density = expansions_length / base_length

        return min(1.0, max(0.0, 0.7 + (semantic_density - 1.0) * 0.1))
